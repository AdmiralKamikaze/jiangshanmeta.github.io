	<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.15" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> 重新学习最好的编程语言 &middot; jsmeta </title>
  
  <link rel="stylesheet" href="http://jiangshanmeta.github.io/css/index.css">
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

</head>

	<body class=" article-body">
		<nav class="article-nav">
			<a href="http://jiangshanmeta.github.io/">Home</a>
			<a href="http://jiangshanmeta.github.io/demo/index.html">前端作品</a>
			<a href="http://jiangshanmeta.github.io/categories/index.html">日志分类</a>
		</nav>
		<div class="article ">
			<div >
			  <h1 class="text-center">重新学习最好的编程语言</h1>
			  <p >Thu, Aug 25, 2016</p>
			      

<p>从前端入的行，现在前端和后端php一起写，虽然日常的业务逻辑对我来说很轻松，但是感觉自己被框架宠坏了。业务中用的框架是封装过的CI，想着从一个空的CI开始做起，至少要脱离现在高度封装过的框架。跟着教程看起，发现了自己对于php很多地方理解不足，这里一条条记录下来。</p>

<h2 id="1-构造函数:960e085aadb29182f9448019a6b3c8f1">1.构造函数</h2>

<p>CI框架默认的<code>controller</code>是welcome，不过业界习惯还是index，我就照着welcome这个<code>controller</code>写了一个index的<code>controller</code>,然后就报错了。我说我这种动不动就建个<code>controller</code>写个几百行的咋建个<code>controller</code>就报错啊。然后百度了一下有人在博客里说是因为这是CI的保留名称所以会报错，可是项目中明明就有controller名为index的啊。后来我发现根本不是这么回事。</p>

<p>问题出在<strong>构造函数</strong>上。在php4的时代，构造函数是和类名同名的函数，但是在php5引入了<code>__construct</code>的概念作为构造函数，同时为了保证向下兼容所以如果没有找到<code>__construct</code>就把同名函数作为构造函数。在这里，我的controller名称是index，方法名称也是index，并且没有<code>__construct</code>所以会把index方法当成构造函数。解决方案也就很明了了：写上构造函数</p>

<pre><code>function __construct(){
	parent::__construct();
}
</code></pre>

<p>因为继承的基类<code>CI_Controller</code>里有构造函数，显然不作死的方案是调用基类的构造函数。看了一眼项目里的代码，我们是一个类继承了<code>CI_Controller</code>，调用了<code>CI_Controller</code>的构造函数，然后做了一些其他的操作。</p>

<h2 id="2-view-template:960e085aadb29182f9448019a6b3c8f1">2.view &amp;&amp; template</h2>

<p>CI是一个MVC框架，最开始我只会画画页面写写js，所以最一开始做的是view层。关于CI的view层<a href="http://codeigniter.org.cn/user_guide/general/views.html">官方文档里已经给出了很好的说明</a>，仅仅从用的角度来说已经足够了。然而如果不对其进行封装很容易做一些重复性的操作，比如说声明对header的加载，声明对footer的加载，而真正业务逻辑对应的页面加载只需要一行，对此我们引入了一个新的类<code>template</code>，把那些header、footer之类的全都放在模板里，在模板里输出真的业务逻辑界面。</p>

<p>下面代码是从项目代码里按照自己的书写习惯稍微改造的，如果不明白其中一些CI的东西可以看上面链接。</p>

<pre><code>class Template{
	public function __construct(){
		$this-&gt;templateData = [];
		$this-&gt;CI = &amp;get_instance();
	}

	public function set($name,$value){
		$this-&gt;templateData[$name] = $value;
	}

	public function load($template,$view,$view_data = array(),$return = FALSE){
		$this-&gt;set('contents',$this-&gt;CI-&gt;load-&gt;view($view,$view_data,TRUE));
		return $this-&gt;CI-&gt;load-&gt;view($template,$this-&gt;templateData,$return);
	}
}
</code></pre>

<p>我们把这个类放在<code>application/libraries</code>目录下<code>template.php</code>文件中，并在autoload中的libraries数组中添加<code>template</code>,这样我们就可以愉快的使用<code>template</code>类了，例如以下代码：</p>

<pre><code>$this-&gt;template-&gt;load(&quot;default_page&quot;,&quot;index/index&quot;);
</code></pre>

			</div>


		</div>
		<script>
console.log("联系我吧   540118044@qq.com");
</script>   
  </body>
</html>
