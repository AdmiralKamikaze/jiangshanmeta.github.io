	<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.15" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> 21天并不能精通CI &middot; jsmeta </title>
  
  <link rel="stylesheet" href="http://jiangshanmeta.github.io/css/index.css">
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

</head>

	<body class=" article-body">
		<nav class="article-nav">
			<a href="http://jiangshanmeta.github.io/">Home</a>
			<a href="http://jiangshanmeta.github.io/demo/index.html">前端作品</a>
			<a href="http://jiangshanmeta.github.io/categories/index.html">日志分类</a>
		</nav>
		<div class="article ">
			<div >
			  <h1 class="text-center">21天并不能精通CI</h1>
			  <p >Sat, Nov 5, 2016</p>
			      

<p>CI是一个MVC的php框架，平时使用的多了所以开始阅读其源码，在这里做个记录。</p>

<h2 id="整体流程:4148907b28e52bc7301c1249655cea8c">整体流程</h2>

<p>要了解一个框架，首先要做的就了解程序的流程。</p>

<p>一般而言，我们请求的是index.php文件，在这个文件中主要定义了三个文件目录：CI系统文件目录、应用程序文件目录、界面层文件目录，然后加载了CodeIgniter.php这一文件，该文件规定了程序的主要逻辑。</p>

<p>在CodeIgniter.php中，首先加载了一些定义好的工具全局函数和变量，然后是基准测试类、钩子类、Config类，到这里都是一些辅助性的东西，接下来的加载URI类和路由类，前者对请求的url进行各种处理得到各段参数，后者对URI类的处理结果根据路由规则进行处理，到这里我们拿到了controller名、method名以及参数。根据路由类的处理结果，我们拿到controller实例，并调用相应的方法（大部分工作就是实现controller里的各种方法），如果需要输出页面的话一般是通过Output类进行。</p>

<p>基本流程就是这样，下面具体展开来看。</p>

<h2 id="index-php:4148907b28e52bc7301c1249655cea8c">index.php</h2>

<p>这个文件是入口文件，虽然看起来有一堆代码，但是真正做的事情并不多。首先是定义当前环境，并且根据环境决定报错等级，然后定义了三个文件目录，分别是系统文件目录(<code>basepath</code>)、应用代码文件目录(<code>APPPATH</code>)和view层目录(<code>VIEWPATH</code>)，大量操作都是用来校验目录合法性的，最后就是加载CodeIgniter.php这一文件。</p>

<h2 id="common-php:4148907b28e52bc7301c1249655cea8c">Common.php</h2>

<p>这个文件包含一些CI封装好的全局函数，先说一部分吧。</p>

<pre><code class="language-is_php```是用来判断当前php版本的，其实就是对```version_compare```这一系统函数的封装，不过在函数内部有一个静态局部变量```_is_php```用来缓存判断的结果(js就只能默默地靠闭包实现这一功能)。">
```get_config```主要是用来获取应用项目中的config文件并保存在静态局部变量```config```中，还可以根据传入的值对```$config```进行补充。

```config_item```是用来获取某个具体的配置的，在实现上首先有一个局部静态变量```_config```，然后```$_config[0] =&amp; get_config();```，这样局部静态变量```_config```保存了对config的引用，这里之所以用一个数组注释里说的很清楚：静态变量无法保存引用，所以用了数组。

```load_class```这个很重要，用来加载并且实例化一些系统类，由于CI扩展性强的特点，这里会判断有没有我们自行扩展的子类然后再实例化，实例化的类会缓存在一个静态局部变量中，用来实现单例。

```is_loaded```是和上面的```load_class```函数配合使用的，用来追踪那些实例化的系统类的，这个函数一个是在```load_class```中用到，还有是在controller的基类的构造函数使用，用来把实例化的系统类挂到controller上。




## Benchmark.php

## Hooks.php

## Config.php

## Controller.php

虽然想按照执行顺序写但是还是先写Controller吧，毕竟controller是日常写的比较多的部分。controller的基类并不复杂：
</code></pre>

<p>class CI_Controller {
    private static $instance;
    public function __construct()
    {
        self::$instance =&amp; $this;
        foreach (is_loaded() as $var =&gt; $class)
        {
            $this-&gt;$var =&amp; load_class($class);
        }</p>

<pre><code>    $this-&gt;load =&amp; load_class('Loader', 'core');
    $this-&gt;load-&gt;initialize();
    log_message('info', 'Controller Class Initialized');
}

public static function &amp;get_instance()
{
    return self::$instance;
}
</code></pre>

<p>}</p>

<pre><code>有一个静态私有变量```$instance```用来存放实例化的controller，静态方法```get_instance```是用来获取这个实例化的controller，在构造函数中，首先```self::$instance =&amp; $this;```把形成的实例存储在静态私有变量```$instance```中，然后把通过```load_class```这一函数实例化的类挂到controller上面，这样我们就可以在controller内通过```$this```访问这些类了。

在CodeIgniter.php文件中一个有关的函数是
</code></pre>

<p>function &amp;get_instance()
{
    return CI_Controller::get_instance();
}</p>

<pre><code>
## Model.php

Model也是业务逻辑经常要实现的，我们看一下model的基类：

</code></pre>

<p>class CI_Model {</p>

<pre><code>public function __construct()
{
    log_message('info', 'Model Class Initialized');
}

public function __get($key)
{
    return get_instance()-&gt;$key;
}
</code></pre>

<p>}
```</p>

<p>CI_Model就这么简短，比较有意思的是对于魔术方法<code>__get</code>的使用，这里利用了get_instance这一函数，当model层没有所查询的变量时就从超级对象CI那里获取。</p>

<h2 id="uri-php:4148907b28e52bc7301c1249655cea8c">URI.php</h2>

<h2 id="router-php:4148907b28e52bc7301c1249655cea8c">Router.php</h2>

<h2 id="loader-php:4148907b28e52bc7301c1249655cea8c">Loader.php</h2>

			</div>


		</div>
		<script>
console.log("联系我吧   540118044@qq.com");
</script>   
  </body>
</html>
